{include file='public/head'}
<div class="layui-field-box">
  <blockquote class="layui-elem-quote">
    <div class="layui-row layui-col-space10">
      <div class="layui-col-md4">
        <form class="layui-form" action="" method="POST">
          <div class="layui-form-item ">
            <input type="text" placeholder="角色ID/角色名，多个与英文逗号分隔" name="roles" class="layui-input" lay-verify="roles">
          </div>
          <div class="layui-form-item ">
            <input type="text" placeholder="封禁原因" name="reason" class="layui-input" lay-verify="reason">
          </div>
          <div class="layui-form-item ">
            <input type="text" id="end_time" placeholder="禁言截止时间" name="end_time" class="layui-input" lay-verify="end_time" autocomplete="off">
          </div>
          <button class="layui-btn layui-btn-sm layui-btn-danger" type="submit" lay-submit="">封禁</button>
        </form>
      </div>
    </div>
  </blockquote>

  <blockquote class="layui-elem-quote">
    <form class="layui-form" method="GET">
      <div class="layui-inline">
        <div class="layui-input-inline">
          <input type="text" placeholder="角色ID/角色名" name="role" class="layui-input" value="{$role}">
        </div>
        <div class="layui-input-inline">
          <button class="layui-btn layui-btn-sm" type="submit">查询</button>
        </div>
        <button onclick="javascript:location.reload()" class="layui-btn layui-btn-sm">刷新</button>
      </div>
    </form>
  </blockquote>
  <table id="table" lay-filter="test"></table>
</div>
{include file='public/foot'}

<script type="text/javascript">
  laydate.render({
    elem: '#end_time'
    ,type: 'datetime'
    ,min: (new Date).toLocaleString()
    ,max: '2118-12-31 23:59:59'
  });

  //表单验证
  form.verify({
    roles: function(value){
      value = $.trim(value);
      if(value.length < 1){
        return '角色都没有啊！';
      }
    },
    reason: function(value){
      value = $.trim(value);
      if(value.length < 1){
        return '请填写一下禁言原因';
      }
    },
  });

  layui.use('table', function(){
    var table = layui.table;
    var tableIns = table.render({
      elem: '#table'
      ,url: 'rolebanned?role={$role}'
      ,page: true
      ,cols: [[
        {field: 'role_id'      , title: '角色ID'   , width:130}
      , {field: 'role_name'    , title: '角色名'}
      , {field: 'account_name' , title: '账号'}
      , {field: 'reason'       , title: '禁言原因'}
      , {field: 'add_time'     , title: '禁言时间' , width:150}
      , {field: 'end_time'     , title: '结束时间' , width:150}
      , {field: 'admin_user'   , title: '操作人'   , width:100}
      , {field: 'status'       , title: '状态'     , width:60}
      , {field: 'action'       , title: '操作'     , width:80}
      ]]
    });
  });

  var unbanned = function(id, status){
    if(id <= 0)
      return;

    $.post('/admin/service/roleUnbanned', {id:id, status:status}, function(msg){
      window.location.reload();
    }, 'json');
  }
</script>
