{include file='public/head'}
<div class="x-body" style=" overflow-y:auto; overflow-x:auto; width:auto; height:auto;">
  <fieldset class="layui-elem-field">
    <legend>
      玩家在线数据
    </legend>
    <div class="layui-field-box">
      <blockquote class="layui-elem-quote">
        <div class="layui-inline">
          <label class="layui-form-label">时间：</label>
          <div class="layui-input-inline">
            <input class="layui-input" id="time2"  autocomplete="off" type="text" value="{$time}">
          </div>
          <div class="layui-input-inline">
            <button class="layui-btn layui-btn-sm" onclick="ajax()">查询</button>
          </div>
          <div class="layui-input-inline">
            <button class="layui-btn layui-btn-sm" onclick="ajax(1)">今天</button>
          </div>
          <div class="layui-input-inline">
            <button class="layui-btn layui-btn-sm" onclick="ajax(2)">昨天</button>
          </div>
          <div class="layui-input-inline">
            <button class="layui-btn layui-btn-sm" onclick="ajax(3)">前天</button>
          </div>
          <div class="layui-input-inline" style="padding-left: 20px;">
            <p style="color: #1abc9c;">
              <b>当天最高在线：<b id="max">0</b></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <b>当天最低在线：<b id="min">0</b></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <b>平均在线：<b id="avg">0</b>  </b>
            </p>
          </div>
        </div>
      </blockquote>
    </div>
    <div class="layui-field-box">
      <div id="container" style="min-width:2000px;height:auto;"></div>
    </div>
  </fieldset>
</div>
<div class="x-body" style=" overflow-y:auto; overflow-x:auto; width:auto; height:auto;">
  <fieldset class="layui-elem-field">
    <legend>
      当前在线用户
    </legend>
    <div class="layui-field-box">
      <blockquote class="layui-elem-quote">
        <div class="layui-inline">
          <div class="layui-input-inline" style="padding-left: 20px;">
            <p style="color: #1abc9c;">
              <b>总注册账号：{$data.create}</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <b>总创建角色：{$data.create}</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <b>当前在线角色：{$data.online}</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <b>当前在线ip：{$data.online}</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <b>当前登录设备：{$data.online}</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            </p>
          </div>
        </div>
      </blockquote>
    </div>
    <div class="layui-field-box">
      <table id="table" lay-filter="test"></table>
    </div>
  </fieldset>
</div>
<script src="/vendor/highcharts/highcharts.js"></script>
<script>
  layui.use('laydate', function() {
    var laydate = layui.laydate;
    laydate.render({
      elem: '#time2'
    });
  });

  layui.use('table', function(){
    var table = layui.table;
    table.render({
      elem: '#table'
      ,url: 'onlinetable'
      ,page: true
      ,cols: [[
      {field: 'id'            , title: 'ID'           , sort: true  , fixed: 'left'}
      , {field: 'role_id'       , title: '角色id'}
      , {field: 'account_name'  , title: '账号'         , sort: true}
      , {field: 'time_alone'    , title: '在线分钟'}
      , {field: 'role_level'    , title: '当前等级'}
      , {field: 'time'          , title: '角色登录时间' , sort: true}
      , {field: 'last_login_ip' , title: '登录IP'       , sort: true}
      , {field: 'classify'      , title: '城市'}
      , {field: 'wealth'        , title: 'mac'          , sort: true}
      ]]
    });
  });

  //获取昨天等时间
  function GetDateStr(AddDayCount) {
    var dd = new Date();
    dd.setDate(dd.getDate()+AddDayCount);//获取AddDayCount天后的日期
    var y = dd.getFullYear();
    var m = dd.getMonth()+1;//获取当前月份的日期
    var d = dd.getDate();
    return y+"-"+m+"-"+d;
  }

  ajax();

  function ajax(day){
    if(day==1){ //今天
      var time = GetDateStr(0);
    }else if(day==2){ //昨天
      var time = GetDateStr(-1);
    }else if(day==3){ //
      var time = GetDateStr(-2);
    }else{
      var time = $("#time2").val();
    }

    $.ajax({
      url: "online",
      type: 'GET',     // 请求类型
      dataType: 'JSON',     // 请求类型
      data: { time:time },
      success: function(data) { // 接口调用成功回调函数
        //修改头变量
        $("#max").html(data.max);
        $("#min").html(data.min);
        $("#avg").html(data.avg);

        var chart = Highcharts.chart('container', {
          chart: {
            type: 'line'                          //指定图表的类型，默认是折线图（line）
          },
          title: {
            text: '在线人数'                 // 标题
          },
          xAxis: {
            categories: data.name   // x 轴分类
          },
          yAxis: {
            title: {
              text: '在线人数'                // y 轴标题
            }
          },
          series: [{                              // 数据列
            name: '在线',                        // 数据列名
            data: data.val                     // 数据
          }]
        });
      }
    });
  }
</script>
{include file='public/foot'}
